<app-navbar></app-navbar>
<ngx-spinner></ngx-spinner>

<div class="container m-nav">
  <div class="row">
    <div class="col-10 margin-auto">
      <div class="row mb-4">
        <div class="btn-group" name="container">
          <button
            class="btn btn-primary"
            btnRadio="unread"
            [(ngModel)]="container"
            (click)="loadMessages()"
          >
            Unread
          </button>
          <button
            class="btn btn-primary"
            btnRadio="inbox"
            [(ngModel)]="container"
            (click)="loadMessages()"
          >
            Inbox
          </button>
          <button
            class="btn btn-primary"
            btnRadio="outbox"
            [(ngModel)]="container"
            (click)="loadMessages()"
          >
            Outbox
          </button>
        </div>
      </div>

      <div class="row" *ngIf="messages?.length === 0"><h5>No messages</h5></div>

      <ng-container *ngIf="messages?.length > 0">
        <div class="row" [hidden]="loading" *ngFor="let message of messages">
          <div class="message">
            <div class="header-info text-muted d-flex mb-1">
              <div *ngIf="container === 'outbox'">
                <span class=""
                  >to
                  {{ message.recipientUsername }}&nbsp;&nbsp;|&nbsp;&nbsp;</span
                >
              </div>
              <div *ngIf="container !== 'outbox'">
                <span class=""
                  >from
                  {{ message.senderUsername }}&nbsp;&nbsp;|&nbsp;&nbsp;</span
                >
              </div>
              <span>sent {{ message.messageSent | timeago }}</span>
            </div>

            <p>{{ message.content }}</p>

            <a
              class="text-btn mr-3 text-info"
              [routerLink]="
                container !== 'outbox'
                  ? ['/user/messages/' + message.senderUsername]
                  : ['/user/messages/' + message.recipientUsername]
              "
            >
              Reply
            </a>

            <button
              (click)="$event.stopPropagation()"
              (click)="deleteMessage(message.id)"
              class="text-btn text-danger"
            >
              Delete
            </button>
          </div>
        </div>
      </ng-container>

      <div
        class="d-flex justify-content-center"
        *ngIf="pagination && !loading && messages?.length !== 0"
      >
        <pagination
          [boundaryLinks]="true"
          [totalItems]="pagination.totalItems"
          [itemsPerPage]="pagination.itemsPerPage"
          [(ngModel)]="pagination.currentPage"
          (pageChanged)="pageChanged($event)"
          previousText="&lsaquo;"
          nextText="&rsaquo;"
          firstText="&laquo;"
          lastText="&raquo;"
        >
        </pagination>
      </div>
    </div>
  </div>
</div>
